var actions={JOIN_CHAT:"join",LEAVE_CHAT:"leave",CHAT_MSG:"chat",UPDATE_LIST:"update",JOIN_TEAM:"team",SWAP_TEAM:"swap",START_GAME:"start",REMOVE_MATCH:"remove"},by={id:"Id",tag:"TagName",class:"ClassName"};function start(){websocket=new WebSocket(socketUrl),websocket.onmessage=onMessage,websocket.onopen=onOpen,websocket.onclose=onClose,websocket.onerror=onError,setTimeout(function(){joinChat()},100)}function onOpen(e){updateChatBox("Server connected...")}function onClose(e){1008===e.code&&(alert(e.reason),window.location.href="users"),updateChatBox("Server disconnected...")}function onError(e){}function onMessage(e){var t=JSON.parse(e.data);if(t.action===actions.JOIN_CHAT){void 0!==t.message&&updateChatBox(t.name+" "+t.message);var n=getElement("onlyOwner",by.id);if(!0===t.owner){var a=document.createElement("select"),i={1:"1 map",2:"2 maps",3:"3 maps",5:"5 maps"};for(var o in i)a.options[a.options.length]=new Option(i[o],o);a.setAttribute("class","form-control"),a.id="BO-chooser";var r=document.createElement("i");r.setAttribute("class","fa fa-play"),r.setAttribute("style","font-size:17px");var s=document.createElement("button");s.setAttribute("type","submit"),s.setAttribute("class","btn btn-default"),s.id="startBtn";var m=document.createElement("strong");m.innerHTML=" START",s.appendChild(r),s.appendChild(m);var d=document.createElement("div");d.id="BO",d.appendChild(a),n.appendChild(d),document.getElementById("btnGroup").appendChild(s)}}if(t.action===actions.LEAVE_CHAT){if(t.id===userId)return;var c=getElement("TeamCT",by.id),l=getElement("TeamT",by.id),u=getElement(t.id,by.id);c.contains(u)?c.removeChild(u):l.contains(u)&&l.removeChild(u),updateChatBox(t.name+" "+t.message)}if(t.action===actions.UPDATE_LIST){if(t.id===userId)return;updateChatBox(t.name+" "+t.message)}t.action===actions.CHAT_MSG&&updateChatBox(t.name+": "+t.message),t.action===actions.JOIN_TEAM&&updateTeamList(t),t.action===actions.SWAP_TEAM&&changeTeam(t),t.action===actions.START_GAME&&getServer(t),t.action===actions.REMOVE_MATCH&&t.id!==userId&&(alert(t.message),window.location.href="users")}function updateChatBox(e){var t=getElement("textAreaMessage",by.id);t.innerHTML+=e+" \n",t.scrollTop=t.scrollHeight}function sendMessage(){var e=getElementText("textMessage",by.id);if(null!==(e=e.trim())&&""!==e){var t={action:actions.CHAT_MSG,id:userId,message:e};setElementText("textMessage",by.id,""),getElement("textMessage",by.id).focus(),sendRequest(t)}}function joinChat(){sendRequest({action:actions.JOIN_CHAT,id:userId,name:userName,url:userUrl,img:userImg})}function leaveChat(){sendRequest({action:actions.LEAVE_CHAT,id:userId})}function swapTeam(){sendRequest({action:actions.SWAP_TEAM,id:userId})}function startGame(){sendRequest({action:actions.START_GAME,id:userId})}function sendRequest(e){void 0!==websocket&&websocket.readyState!==WebSocket.CLOSED?websocket.send(JSON.stringify(e)):alert("Connection lost to Server. Please try again later.")}function closeSocket(){leaveChat(),setTimeout(function(){void 0===websocket&&websocket.readyState===WebSocket.CLOSED||websocket.close()},1e3)}function getElement(e,t){var n;switch(t){case by.id:n=document.getElementById(e);break;case by.tag:n=document.getElementsByTagName(e);break;case by.class:n=document.getElementsByClassName(e);break;default:n=document.getElementById(e)}return n}function setElementText(e,t,n){getElement(e,t).value=n}function getElementText(e,t){return getElement(e,t).value}function infoUser(e){var t=document.createElement("h3");t.innerHTML=e.name;var n=document.createElement("a");n.setAttribute("href",e.url),n.appendChild(t),n.target="_blank";var a=document.createElement("img");a.src=e.img;var i=document.createElement("span");i.setAttribute("class","player-avatar pull-left"),i.appendChild(a);var o=document.createElement("div");o.setAttribute("class","player-name clearfix"),o.appendChild(n);var r=document.createElement("div");r.setAttribute("class","player-slot"),r.setAttribute("id",e.id);var s=document.createElement("input");s.type="text","team1"===e.team&&(s.name="Team1"),"team2"===e.team&&(s.name="Team2"),s.setAttribute("value",e.id),s.setAttribute("hidden","");var m=document.createElement("input");return m.type="text","team1"===e.team&&(m.name="Team1Name"),"team2"===e.team&&(m.name="Team2Name"),m.setAttribute("value",e.name),m.setAttribute("hidden",""),r.appendChild(i),r.appendChild(o),r.appendChild(s),r.appendChild(m),r}function updateTeamList(e){var t=getElement("TeamCT",by.id),n=getElement("TeamT",by.id),a=infoUser(e);"team1"===e.team?t.appendChild(a):"team2"===e.team&&n.appendChild(a)}function changeTeam(e){var t=getElement("TeamCT",by.id),n=getElement("TeamT",by.id),a=infoUser(e);"team1"===e.team?(n.removeChild(getElement(e.id,by.id)),t.appendChild(a)):"team2"===e.team&&(t.removeChild(getElement(e.id,by.id)),n.appendChild(a))}function getServer(e){null!==getElement("BO",by.id)&&remove("BO"),remove("switchBtn"),null!==getElement("startBtn",by.id)&&remove("startBtn");var t=document.createElement("button");t.setAttribute("class","btn-danger btn-lg"),t.setAttribute("onclick","window.open('"+e.url+"','_blank')"),t.setAttribute("type","button");var n=document.createElement("strong");n.innerHTML="CONNECT TO SERVER",t.appendChild(n);var a=document.createElement("div");a.appendChild(t);var i=document.createElement("input");i.setAttribute("type","text"),i.setAttribute("class","form-control"),i.value=e.ip,i.id="copyTarget",i.setAttribute("readonly","");var o=document.createElement("i");o.setAttribute("class","fa fa-copy"),o.setAttribute("style","font-size:20px; padding: 7px; color: black");var r=document.createElement("a");r.id="copyButton",r.setAttribute("onclick","copy('copyTarget')"),r.setAttribute("data-toggle","tooltip"),r.setAttribute("title","Copy to clipboard"),r.href="#",r.appendChild(o);var s=document.createElement("div");s.setAttribute("class","icon-wrapper"),s.appendChild(r);var m=document.createElement("div");m.setAttribute("class","server-ip-wrapper"),m.appendChild(i),m.appendChild(s);var d=getElement("server",by.id);d.appendChild(a),d.appendChild(m)}function copy(e){getElement(e,by.id).select(),document.execCommand("copy"),document.getElementById("myTooltip").innerHTML="Copied"}function remove(e){var t=getElement(e,by.id);t.parentNode.removeChild(t)}getElement("textMessage",by.id).addEventListener("keyup",function(e){e.preventDefault(),13===e.keyCode&&sendMessage()}),$(document).ready(function(){var e;$("#teamList").submit(function(t){t.preventDefault();var n=$("input[name='Team1']").map(function(){return $(this).val()}).get(),a=$("input[name='Team2']").map(function(){return $(this).val()}).get(),i=$("input[name='Team1Name']").map(function(){return $(this).val()}).get(),o=$("input[name='Team2Name']").map(function(){return $(this).val()}).get();i=i[0],o=o[0];var r=$("#BO-chooser").val();n.length>5&&a.length>5?alert("Not enought player"):(clearTimeout(e),e=setTimeout(function(){$.ajax({url:"match",data:{action:"start",Team1:n,Team2:a,Team1Name:i,Team2Name:o,numMaps:r},success:function(e){200===e.status?(startGame(),console.log(e.msg)):alert(e.msg)}})},1e3))})});