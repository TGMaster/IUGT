var actions={JOIN_CHAT:"join",LEAVE_CHAT:"leave",CHAT_MSG:"chat",UPDATE_LIST:"update",JOIN_TEAM:"team",SWAP_TEAM:"swap",START_GAME:"start",REMOVE_MATCH:"remove"},by={id:"Id",tag:"TagName",class:"ClassName"};function start(){websocket=new WebSocket(socketUrl),websocket.onmessage=onMessage,websocket.onopen=onOpen,websocket.onclose=onClose,websocket.onerror=onError,setTimeout(function(){joinChat()},100)}function onOpen(e){updateChatBox("Server connected...")}function onClose(e){1008===e.code&&(alert(e.reason),window.location.href="users"),updateChatBox("Server disconnected...")}function onError(e){}function onMessage(e){var t=JSON.parse(e.data);if(t.action===actions.JOIN_CHAT){void 0!==t.message&&updateChatBox(t.name+" "+t.message);var a=getElement("onlyOwner",by.id);if(!0===t.owner){var n=document.createElement("select"),i={1:"BO 1",2:"BO 2",3:"BO 3",5:"BO 5"};for(var o in i)n.options[n.options.length]=new Option(i[o],o);n.setAttribute("class","form-control"),n.id="BO-chooser";var r=document.createElement("button");r.setAttribute("type","submit"),r.setAttribute("class","form-control btn-success"),r.id="numMaps";var s=document.createTextNode("Start");r.appendChild(s);var c=document.createElement("div");c.id="BO",c.appendChild(n),c.appendChild(r),a.appendChild(c)}}if(t.action===actions.LEAVE_CHAT){if(t.id===userId)return;var d=getElement("TeamCT",by.id),m=getElement("TeamT",by.id),l=getElement(t.id,by.id);d.contains(l)?d.removeChild(l):m.contains(l)&&m.removeChild(l),updateChatBox(t.name+" "+t.message)}if(t.action===actions.UPDATE_LIST){if(t.id===userId)return;updateChatBox(t.name+" "+t.message)}t.action===actions.CHAT_MSG&&updateChatBox(t.name+": "+t.message),t.action===actions.JOIN_TEAM&&updateTeamList(t),t.action===actions.SWAP_TEAM&&changeTeam(t),t.action===actions.START_GAME&&getServer(t),t.action===actions.REMOVE_MATCH&&t.id!==userId&&(alert(t.message),window.location.href="users")}function updateChatBox(e){getElement("textAreaMessage",by.id).innerHTML+=e+" \n"}function sendMessage(){var e=getElementText("textMessage",by.id);if(null!==(e=e.trim())&&""!==e){var t={action:actions.CHAT_MSG,id:userId,message:e};setElementText("textMessage",by.id,""),getElement("textMessage",by.id).focus(),sendRequest(t)}}function joinChat(){sendRequest({action:actions.JOIN_CHAT,id:userId,name:userName,url:userUrl,img:userImg})}function leaveChat(){sendRequest({action:actions.LEAVE_CHAT,id:userId})}function swapTeam(){sendRequest({action:actions.SWAP_TEAM,id:userId})}function startGame(){sendRequest({action:actions.START_GAME,id:userId})}function sendRequest(e){void 0!==websocket&&websocket.readyState!==WebSocket.CLOSED?websocket.send(JSON.stringify(e)):alert("Connection lost to Server. Please try again later.")}function closeSocket(){leaveChat(),setTimeout(function(){void 0===websocket&&websocket.readyState===WebSocket.CLOSED||websocket.close()},1e3)}function getElement(e,t){var a;switch(t){case by.id:a=document.getElementById(e);break;case by.tag:a=document.getElementsByTagName(e);break;case by.class:a=document.getElementsByClassName(e);break;default:a=document.getElementById(e)}return a}function setElementText(e,t,a){getElement(e,t).value=a}function getElementText(e,t){return getElement(e,t).value}function infoUser(e){var t=document.createElement("a");t.setAttribute("href",e.url),t.appendChild(document.createTextNode(e.name)),t.target="_blank";var a=document.createElement("img");a.src=e.img;var n=document.createElement("span");n.setAttribute("class","player-avatar pull-left"),n.appendChild(a);var i=document.createElement("div");i.setAttribute("class","player-name clearfix"),i.appendChild(t);var o=document.createElement("div");o.setAttribute("class","player-slot"),o.setAttribute("id",e.id);var r=document.createElement("input");r.type="text","team1"===e.team&&(r.name="Team1"),"team2"===e.team&&(r.name="Team2"),r.setAttribute("value",e.id),r.setAttribute("hidden","");var s=document.createElement("input");return s.type="text","team1"===e.team&&(s.name="Team1Name"),"team2"===e.team&&(s.name="Team2Name"),s.setAttribute("value",e.name),s.setAttribute("hidden",""),o.appendChild(n),o.appendChild(i),o.appendChild(r),o.appendChild(s),o}function updateTeamList(e){var t=getElement("TeamCT",by.id),a=getElement("TeamT",by.id),n=infoUser(e);"team1"===e.team?t.appendChild(n):"team2"===e.team&&a.appendChild(n)}function changeTeam(e){var t=getElement("TeamCT",by.id),a=getElement("TeamT",by.id),n=infoUser(e);"team1"===e.team?(a.removeChild(getElement(e.id,by.id)),t.appendChild(n)):"team2"===e.team&&(t.removeChild(getElement(e.id,by.id)),a.appendChild(n))}function getServer(e){null!==getElement("BO",by.id)&&remove("BO"),remove("switchBtn");var t=document.createElement("button");t.setAttribute("class","btn-danger btn-lg"),t.setAttribute("onclick","window.open('"+e.url+"','_blank')");var a=document.createTextNode("CONNECT TO SERVER");t.appendChild(a);var n=document.createElement("div");n.appendChild(t);var i=document.createElement("input");i.setAttribute("type","text"),i.setAttribute("class","form-control"),i.value=e.ip,i.id="copyTarget",i.setAttribute("readonly","");var o=document.createElement("i");o.setAttribute("class","fa fa-copy");var r=document.createElement("a");r.id="copyButton",r.setAttribute("onclick","copy('copyTarget')"),r.setAttribute("data-toggle","tooltip"),r.setAttribute("title","Copy to clipboard"),r.href="#",r.appendChild(o);var s=document.createElement("div");s.setAttribute("class","icon-wrapper"),s.appendChild(r);var c=document.createElement("div");c.setAttribute("class","server-ip-wrapper"),c.appendChild(i),c.appendChild(s);var d=getElement("server",by.id);d.appendChild(n),d.appendChild(c)}function copy(e){getElement(e,by.id).select(),document.execCommand("copy"),document.getElementById("myTooltip").innerHTML="Copied"}function remove(e){var t=getElement(e,by.id);t.parentNode.removeChild(t)}getElement("textMessage",by.id).addEventListener("keyup",function(e){e.preventDefault(),13===e.keyCode&&sendMessage()}),$(document).ready(function(){var e;$("#teamList").submit(function(t){t.preventDefault();var a=$("input[name='Team1']").map(function(){return $(this).val()}).get(),n=$("input[name='Team2']").map(function(){return $(this).val()}).get(),i=$("input[name='Team1Name']").map(function(){return $(this).val()}).get(),o=$("input[name='Team2Name']").map(function(){return $(this).val()}).get();i=i[0],o=o[0];var r=$("#BO-chooser").val();a.length>5&&n.length>5?alert("Not enought player"):(clearTimeout(e),e=setTimeout(function(){$.ajax({url:"match",data:{action:"start",Team1:a,Team2:n,Team1Name:i,Team2Name:o,numMaps:r},success:function(e){console.log(e),startGame()}})},1e3))})});